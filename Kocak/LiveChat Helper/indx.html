<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveChat Helper - Quick Response</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- Toast Notification -->
    <div id="toast" class="hidden"></div>

    <!-- Header -->
    <div class="bg-white shadow-lg border-b-4 border-indigo-600">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-gradient-to-br from-indigo-600 to-purple-600 p-3 rounded-xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-slate-800">LiveChat Helper</h1>
                        <p class="text-sm text-slate-600">Quick Response & Template Manager</p>
                    </div>
                </div>
                <button onclick="showPage('stats')" class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors flex items-center gap-2 font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Statistik
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Panel - Categories & Templates -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Category Management -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-4">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            Kategori
                        </h2>
                    </div>
                    <div class="p-4 space-y-3">
                        <button onclick="filterCategory('all')" class="category-btn w-full text-left px-4 py-3 rounded-lg bg-indigo-50 text-indigo-700 font-medium hover:bg-indigo-100 transition-colors">
                            üìã Semua Template
                        </button>
                        <div id="category-list"></div>
                        
                        <!-- Add Category -->
                        <div class="pt-3 border-t border-slate-200">
                            <input type="text" id="new-category" placeholder="Kategori baru..." class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 mb-2">
                            <button onclick="addCategory()" class="w-full px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Tambah Kategori
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-slate-800 mb-4">Quick Stats</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600">Total Template:</span>
                            <span id="total-templates" class="font-bold text-indigo-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600">Paling Sering:</span>
                            <span id="most-used" class="font-bold text-green-600">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600">Digunakan Hari Ini:</span>
                            <span id="used-today" class="font-bold text-blue-600">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Middle Panel - Templates List -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Add Template -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4 flex justify-between items-center cursor-pointer" onclick="toggleAddTemplate()">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Tambah Template Baru
                        </h2>
                        <svg id="add-icon" class="w-5 h-5 text-white transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                    <div id="add-template-form" class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Judul Template</label>
                            <input type="text" id="template-title" placeholder="Contoh: Salam Pembuka" class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Kategori</label>
                            <select id="template-category" class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Pilih Kategori</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Pesan Template</label>
                            <textarea id="template-message" rows="4" placeholder="Ketik template pesan Anda di sini..." class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                            <p class="text-xs text-slate-500 mt-1">üí° Gunakan {nama} atau {produk} sebagai placeholder yang bisa diganti nanti</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="saveTemplate()" class="flex-1 px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Simpan Template
                            </button>
                            <button onclick="clearTemplateForm()" class="px-4 py-2.5 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium">
                                Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Search & Filter -->
                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div class="flex gap-3">
                        <div class="flex-1 relative">
                            <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <input type="text" id="search-template" onkeyup="searchTemplates()" placeholder="Cari template..." class="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button onclick="showAllTemplates()" class="px-4 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium">
                            Reset Filter
                        </button>
                    </div>
                </div>

                <!-- Templates List -->
                <div id="templates-container" class="space-y-4">
                    <!-- Templates will be rendered here -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="bg-white rounded-xl shadow-lg p-12 text-center">
                    <svg class="w-20 h-20 mx-auto mb-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <h3 class="text-xl font-bold text-slate-700 mb-2">Belum Ada Template</h3>
                    <p class="text-slate-500 mb-4">Mulai dengan menambahkan template balasan pertama Anda</p>
                    <button onclick="toggleAddTemplate()" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium">
                        Buat Template Pertama
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="stats-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Statistik Penggunaan</h2>
                <button onclick="closeStats()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                        <div class="text-3xl font-bold mb-2" id="stat-total">0</div>
                        <div class="text-blue-100">Total Template</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white">
                        <div class="text-3xl font-bold mb-2" id="stat-used">0</div>
                        <div class="text-green-100">Total Digunakan</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                        <div class="text-3xl font-bold mb-2" id="stat-categories">0</div>
                        <div class="text-purple-100">Total Kategori</div>
                    </div>
                </div>

                <h3 class="font-bold text-slate-800 mb-4 text-lg">Template Paling Sering Digunakan</h3>
                <div id="top-templates" class="space-y-3">
                    <!-- Top templates will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let appData = {
            categories: ['Salam', 'Informasi Produk', 'Konfirmasi', 'Penutup', 'Keluhan'],
            templates: [],
            currentFilter: 'all',
            stats: {
                totalUsed: 0,
                usedToday: 0
            }
        };

        // Icons for categories
        const categoryIcons = {
            'Salam': 'üëã',
            'Informasi Produk': 'üì¶',
            'Konfirmasi': '‚úÖ',
            'Penutup': 'üôè',
            'Keluhan': '‚ö†Ô∏è',
            'default': 'üìù'
        };

        // Initialize app
        function initApp() {
            loadFromStorage();
            renderCategories();
            renderTemplates();
            updateStats();
            updateCategoryDropdown();
        }

        // Load from localStorage
        function loadFromStorage() {
            const saved = localStorage.getItem('livechatHelperData');
            if (saved) {
                appData = JSON.parse(saved);
                // Ensure stats object exists
                if (!appData.stats) {
                    appData.stats = { totalUsed: 0, usedToday: 0 };
                }
            }
        }

        // Save to localStorage
        function saveToStorage() {
            localStorage.setItem('livechatHelperData', JSON.stringify(appData));
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3`;
            
            const icon = type === 'success' 
                ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'
                : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
            
            toast.innerHTML = `${icon}<span>${message}</span>`;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Add category
        function addCategory() {
            const input = document.getElementById('new-category');
            const category = input.value.trim();
            
            if (category && !appData.categories.includes(category)) {
                appData.categories.push(category);
                input.value = '';
                saveToStorage();
                renderCategories();
                updateCategoryDropdown();
                showToast(`Kategori "${category}" berhasil ditambahkan!`);
            } else if (appData.categories.includes(category)) {
                showToast('Kategori sudah ada!', 'error');
            }
        }

        // Render categories
        function renderCategories() {
            const container = document.getElementById('category-list');
            container.innerHTML = '';
            
            appData.categories.forEach(cat => {
                const count = appData.templates.filter(t => t.category === cat).length;
                const icon = categoryIcons[cat] || categoryIcons.default;
                
                container.innerHTML += `
                    <button onclick="filterCategory('${cat}')" class="category-btn w-full text-left px-4 py-3 rounded-lg bg-slate-50 text-slate-700 hover:bg-slate-100 transition-colors flex items-center justify-between group">
                        <span class="font-medium">${icon} ${cat}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-xs bg-slate-200 px-2 py-1 rounded-full">${count}</span>
                            <button onclick="deleteCategory(event, '${cat}')" class="opacity-0 group-hover:opacity-100 text-red-600 hover:bg-red-50 p-1 rounded transition-all">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </button>
                `;
            });
        }

        // Delete category
        function deleteCategory(event, category) {
            event.stopPropagation();
            
            if (confirm(`Hapus kategori "${category}"? Template dalam kategori ini tidak akan terhapus.`)) {
                appData.categories = appData.categories.filter(c => c !== category);
                saveToStorage();
                renderCategories();
                updateCategoryDropdown();
                showToast(`Kategori "${category}" berhasil dihapus!`);
            }
        }

        // Update category dropdown
        function updateCategoryDropdown() {
            const select = document.getElementById('template-category');
            select.innerHTML = '<option value="">Pilih Kategori</option>';
            
            appData.categories.forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        // Toggle add template form
        function toggleAddTemplate() {
            const form = document.getElementById('add-template-form');
            const icon = document.getElementById('add-icon');
            
            if (form.classList.contains('hidden')) {
                form.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                form.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Save template
        function saveTemplate() {
            const title = document.getElementById('template-title').value.trim();
            const category = document.getElementById('template-category').value;
            const message = document.getElementById('template-message').value.trim();
            
            if (!title || !category || !message) {
                showToast('Mohon lengkapi semua field!', 'error');
                return;
            }
            
            const template = {
                id: Date.now(),
                title,
                category,
                message,
                usedCount: 0,
                createdAt: new Date().toISOString()
            };
            
            appData.templates.push(template);
            saveToStorage();
            renderTemplates();
            updateStats();
            clearTemplateForm();
            showToast(`Template "${title}" berhasil disimpan!`);
        }

        // Clear template form
        function clearTemplateForm() {
            document.getElementById('template-title').value = '';
            document.getElementById('template-category').value = '';
            document.getElementById('template-message').value = '';
        }

        // Filter category
        function filterCategory(category) {
            appData.currentFilter = category;
            
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-50', 'text-indigo-700');
                btn.classList.add('bg-slate-50', 'text-slate-700');
            });
            
            event.target.closest('.category-btn').classList.remove('bg-slate-50', 'text-slate-700');
            event.target.closest('.category-btn').classList.add('bg-indigo-50', 'text-indigo-700');
            
            renderTemplates();
        }

        // Show all templates
        function showAllTemplates() {
            appData.currentFilter = 'all';
            document.getElementById('search-template').value = '';
            
            // Reset active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-50', 'text-indigo-700');
                btn.classList.add('bg-slate-50', 'text-slate-700');
            });
            document.querySelector('.category-btn').classList.add('bg-indigo-50', 'text-indigo-700');
            
            renderTemplates();
        }

        // Search templates
        function searchTemplates() {
            const query = document.getElementById('search-template').value.toLowerCase();
            const filtered = appData.templates.filter(t => 
                t.title.toLowerCase().includes(query) || 
                t.message.toLowerCase().includes(query)
            );
            renderTemplates(filtered);
        }

        // Render templates
        function renderTemplates(customList = null) {
            const container = document.getElementById('templates-container');
            const emptyState = document.getElementById('empty-state');
            
            let templates = customList || appData.templates;
            
            if (appData.currentFilter !== 'all' && !customList) {
                templates = templates.filter(t => t.category === appData.currentFilter);
            }
            
            if (templates.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');
            container.innerHTML = '';
            
            templates.forEach(template => {
                const icon = categoryIcons[template.category] || categoryIcons.default;
                
                container.innerHTML += `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow fade-in">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <h3 class="font-bold text-slate-800 text-lg mb-2">${template.title}</h3>
                                    <span class="inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-medium">
                                        ${icon} ${template.category}
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="editTemplate(${template.id})" class="text-slate-600 hover:text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition-colors" title="Edit">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                    </button>
                                    <button onclick="deleteTemplate(${template.id})" class="text-slate-600 hover:text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors" title="Hapus">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-slate-50 rounded-lg p-4 mb-4">
                                <p class="text-slate-700 whitespace-pre-wrap">${template.message}</p>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="text-xs text-slate-500">
                                    Digunakan: <span class="font-semibold text-slate-700">${template.usedCount} kali</span>
                                </div>
                                <button onclick="copyTemplate(${template.id})" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all font-medium flex items-center gap-2 shadow-md hover:shadow-lg">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    Salin & Gunakan
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Copy template to clipboard
        function copyTemplate(id) {
            const template = appData.templates.find(t => t.id === id);
            if (!template) return;
            
            // Check if message has placeholders
            if (template.message.includes('{') && template.message.includes('}')) {
                showPlaceholderModal(template);
            } else {
                copyToClipboard(template.message);
                template.usedCount++;
                appData.stats.totalUsed++;
                appData.stats.usedToday++;
                saveToStorage();
                updateStats();
                renderTemplates();
                showToast(`Template "${template.title}" berhasil disalin!`);
            }
        }

        // Show placeholder modal
        function showPlaceholderModal(template) {
            const placeholders = template.message.match(/{([^}]+)}/g) || [];
            const uniquePlaceholders = [...new Set(placeholders)];
            
            let inputsHTML = '';
            uniquePlaceholders.forEach(placeholder => {
                const name = placeholder.replace(/{|}/g, '');
                inputsHTML += `
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">${name}</label>
                        <input type="text" id="placeholder-${name}" placeholder="Isi ${name}..." class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                `;
            });
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                        <h3 class="text-xl font-bold text-white">Isi Placeholder</h3>
                    </div>
                    <div class="p-6">
                        ${inputsHTML}
                        <div class="flex gap-3">
                            <button onclick="applyPlaceholders(${template.id}, this.closest('.fixed'))" class="flex-1 px-4 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium">
                                Salin
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2.5 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium">
                                Batal
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Apply placeholders
        function applyPlaceholders(id, modal) {
            const template = appData.templates.find(t => t.id === id);
            if (!template) return;
            
            let message = template.message;
            const placeholders = message.match(/{([^}]+)}/g) || [];
            const uniquePlaceholders = [...new Set(placeholders)];
            
            uniquePlaceholders.forEach(placeholder => {
                const name = placeholder.replace(/{|}/g, '');
                const value = document.getElementById(`placeholder-${name}`).value;
                message = message.replace(new RegExp(placeholder, 'g'), value);
            });
            
            copyToClipboard(message);
            template.usedCount++;
            appData.stats.totalUsed++;
            appData.stats.usedToday++;
            saveToStorage();
            updateStats();
            renderTemplates();
            showToast(`Template "${template.title}" berhasil disalin!`);
            modal.remove();
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text);
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }

        // Edit template
        function editTemplate(id) {
            const template = appData.templates.find(t => t.id === id);
            if (!template) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-auto">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                        <h3 class="text-xl font-bold text-white">Edit Template</h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Judul Template</label>
                            <input type="text" id="edit-title" value="${template.title}" class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Kategori</label>
                            <select id="edit-category" class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                ${appData.categories.map(cat => `<option value="${cat}" ${cat === template.category ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Pesan Template</label>
                            <textarea id="edit-message" rows="6" class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none">${template.message}</textarea>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="updateTemplate(${id}, this.closest('.fixed'))" class="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                Update Template
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2.5 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium">
                                Batal
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Update template
        function updateTemplate(id, modal) {
            const template = appData.templates.find(t => t.id === id);
            if (!template) return;
            
            const title = document.getElementById('edit-title').value.trim();
            const category = document.getElementById('edit-category').value;
            const message = document.getElementById('edit-message').value.trim();
            
            if (!title || !message) {
                showToast('Judul dan pesan tidak boleh kosong!', 'error');
                return;
            }
            
            template.title = title;
            template.category = category;
            template.message = message;
            
            saveToStorage();
            renderTemplates();
            showToast(`Template "${title}" berhasil diupdate!`);
            modal.remove();
        }

        // Delete template
        function deleteTemplate(id) {
            const template = appData.templates.find(t => t.id === id);
            if (!template) return;
            
            if (confirm(`Hapus template "${template.title}"?`)) {
                appData.templates = appData.templates.filter(t => t.id !== id);
                saveToStorage();
                renderTemplates();
                updateStats();
                showToast(`Template "${template.title}" berhasil dihapus!`);
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('total-templates').textContent = appData.templates.length;
            document.getElementById('used-today').textContent = appData.stats.usedToday;
            
            // Find most used template
            if (appData.templates.length > 0) {
                const mostUsed = appData.templates.reduce((prev, current) => 
                    (prev.usedCount > current.usedCount) ? prev : current
                );
                document.getElementById('most-used').textContent = mostUsed.usedCount > 0 ? mostUsed.title : '-';
            } else {
                document.getElementById('most-used').textContent = '-';
            }
        }

        // Show stats modal
        function showPage(page) {
            if (page === 'stats') {
                document.getElementById('stats-modal').classList.remove('hidden');
                renderStats();
            }
        }

        // Render stats
        function renderStats() {
            document.getElementById('stat-total').textContent = appData.templates.length;
            document.getElementById('stat-used').textContent = appData.stats.totalUsed;
            document.getElementById('stat-categories').textContent = appData.categories.length;
            
            const topTemplates = [...appData.templates]
                .sort((a, b) => b.usedCount - a.usedCount)
                .slice(0, 10);
            
            const container = document.getElementById('top-templates');
            if (topTemplates.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center py-8">Belum ada template yang digunakan</p>';
                return;
            }
            
            container.innerHTML = '';
            topTemplates.forEach((template, index) => {
                const icon = categoryIcons[template.category] || categoryIcons.default;
                container.innerHTML += `
                    <div class="bg-slate-50 rounded-lg p-4 flex items-center justify-between hover:bg-slate-100 transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold">
                                ${index + 1}
                            </div>
                            <div>
                                <div class="font-semibold text-slate-800">${template.title}</div>
                                <div class="text-sm text-slate-600">${icon} ${template.category}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-indigo-600">${template.usedCount}</div>
                            <div class="text-xs text-slate-500">kali digunakan</div>
                        </div>
                    </div>
                `;
            });
        }

        // Close stats modal
        function closeStats() {
            document.getElementById('stats-modal').classList.add('hidden');
        }

        // Add some sample templates
        function addSampleTemplates() {
            if (appData.templates.length === 0) {
                const samples = [
                    {
                        id: Date.now(),
                        title: 'Salam Pembuka',
                        category: 'Salam',
                        message: 'Halo {nama}! Selamat datang di layanan customer service kami. Ada yang bisa saya bantu hari ini? üòä',
                        usedCount: 0,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 1,
                        title: 'Info Stok Produk',
                        category: 'Informasi Produk',
                        message: 'Untuk produk {produk}, saat ini stok kami tersedia. Harga: Rp {harga}. Apakah Anda tertarik untuk melakukan pemesanan?',
                        usedCount: 0,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 2,
                        title: 'Konfirmasi Pesanan',
                        category: 'Konfirmasi',
                        message: 'Terima kasih atas pesanannya! Order ID: {orderid} telah kami terima. Pesanan Anda akan segera kami proses. Estimasi pengiriman 2-3 hari kerja. ‚úÖ',
                        usedCount: 0,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 3,
                        title: 'Penutup Percakapan',
                        category: 'Penutup',
                        message: 'Terima kasih sudah menghubungi kami! Jika ada pertanyaan lain, jangan ragu untuk chat kembali ya. Semoga harimu menyenangkan! üôè',
                        usedCount: 0,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 4,
                        title: 'Maaf atas Ketidaknyamanan',
                        category: 'Keluhan',
                        message: 'Mohon maaf atas ketidaknyamanan yang terjadi. Kami sangat memahami situasi Anda. Tim kami akan segera menindaklanjuti masalah ini dan memberikan solusi terbaik. üôè',
                        usedCount: 0,
                        createdAt: new Date().toISOString()
                    }
                ];
                
                appData.templates = samples;
                saveToStorage();
                renderTemplates();
                updateStats();
                showToast('Sample templates berhasil ditambahkan!');
            }
        }

        // Initialize app on load
        window.onload = function() {
            initApp();
            
            // Add sample templates button if no templates exist
            if (appData.templates.length === 0) {
                const emptyState = document.getElementById('empty-state');
                emptyState.innerHTML += `
                    <button onclick="addSampleTemplates()" class="mt-4 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                        Tambah Sample Templates
                    </button>
                `;
            }
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('search-template').focus();
            }
            
            // ESC to close modals
            if (e.key === 'Escape') {
                closeStats();
                const modals = document.querySelectorAll('.fixed');
                modals.forEach(modal => modal.remove());
            }
        });
    </script>
</body>
</html>